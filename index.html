<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>五十音泡泡消消樂</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #e0f7fa;
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #ui-panel {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            z-index: 100;
            pointer-events: none;
        }
        #target-display {
            font-size: 80px;
            background: white;
            padding: 10px 40px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            color: #ff4081;
        }
        .bubble {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at 30% 30%, #fff, #81d4fa);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: #0277bd;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            animation: float 8s linear infinite;
        }
        @keyframes float {
            0% { transform: translateY(100vh); }
            100% { transform: translateY(-20vh); }
        }
        #start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        button {
            padding: 20px 40px;
            font-size: 30px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>五十音泡泡消消樂</h1>
    <p>聽聲音，找到正確的泡泡！</p>
    <button onclick="startGame()">開始遊戲</button>
</div>

<div id="ui-panel">
    <span id="target-display">?</span>
</div>

<div id="game-container"></div>

<script>
    const kanaList = ['あ','い','う','え','お','か','き','く','け','こ','さ','し','す','せ','そ','た','ち','つ','て','と','な','に','ぬ','ね','の'];
    let currentTarget = "";
    const container = document.getElementById('game-container');
    const display = document.getElementById('target-display');

    // 語音設定
    const synth = window.speechSynthesis;
    
    function speak(text) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'ja-JP';
        utter.rate = 0.8;
        synth.speak(utter);
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        nextRound();
        setInterval(createBubble, 1500); // 每1.5秒出一個泡泡
    }

    function nextRound() {
        currentTarget = kanaList[Math.floor(Math.random() * kanaList.length)];
        display.innerText = currentTarget;
        speak(currentTarget);
    }

    function createBubble() {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        
        // 隨機決定這個泡泡是什麼字（50%機率出現目標字，讓小孩容易找到）
        const isTarget = Math.random() > 0.5;
        const char = isTarget ? currentTarget : kanaList[Math.floor(Math.random() * kanaList.length)];
        
        bubble.innerText = char;
        bubble.style.left = Math.random() * 80 + 5 + "vw"; // 隨機水平位置
        
        // 點擊事件
        bubble.onclick = function() {
            if (char === currentTarget) {
                // 答對了
                bubble.style.background = '#c8e6c9';
                bubble.style.transform = 'scale(1.5)';
                setTimeout(() => bubble.remove(), 100);
                nextRound(); // 下一題
            } else {
                // 答錯了
                bubble.style.background = '#ffcdd2';
                speak("ちがうよ (不對喔)"); // 也可以不說話只震動
            }
        };

        // 泡泡飄出畫面後自動刪除，節省效能
        bubble.addEventListener('animationiteration', () => bubble.remove());
        
        container.appendChild(bubble);
        
        // 10秒後沒點到也自動移除
        setTimeout(() => { if(bubble.parentNode) bubble.remove(); }, 10000);
    }

    // 點擊上方大字可以重複聽讀音
    display.onclick = () => speak(currentTarget);
</script>

</body>
</html>
