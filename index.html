<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº”åéŸ³å†’éšª Ver 3.4.0</title>
    <style>
        :root {
            --pink: #FFD1DC;
            --blue: #BFEAF2;
            --yellow: #FFF4BD;
            --text: #5d4037;
            --white: #ffffff;
            --soft-bg: #FFFBFA;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            color: var(--text);
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--soft-bg);
            background-image: radial-gradient(var(--pink) 1.5px, transparent 1.5px);
            background-size: 25px 25px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        /* å°è¦½åˆ— */
        .nav-header {
            width: 100%; background: white; padding: 12px 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--pink);
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
        }

        .btn-home {
            text-decoration: none; background: var(--yellow); padding: 8px 18px;
            border-radius: 50px; font-weight: bold; font-size: 0.95rem;
            border: 2.5px solid var(--text);
        }

        /* æ¨¡å¼èˆ‡ç¯„åœé¸æ“‡ */
        .control-panel {
            width: 95%; max-width: 500px; padding: 15px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 20px; margin-top: 10px;
        }

        .mode-selector { display: flex; gap: 10px; justify-content: center; margin-bottom: 12px; }
        .mode-btn {
            flex: 1; padding: 10px; border-radius: 15px; border: 2.5px solid var(--pink);
            background: white; font-weight: bold; font-size: 1rem;
        }
        .mode-btn.active { background: var(--pink); color: white; }

        .row-selector { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .row-btn {
            padding: 6px 14px; background: white; border: 2px solid var(--blue);
            border-radius: 12px; font-weight: bold; font-size: 0.9rem;
        }
        .row-btn.active { background: var(--blue); border-color: #89cff0; }

        /* ä¸»èˆå° */
        #main-stage {
            width: 100%; max-width: 500px; flex-grow: 1;
            padding: 20px; display: flex; flex-direction: column; align-items: center;
        }

        /* æ¸¬é©—é¡Œç›®å€ */
        .quiz-card {
            background: white; border: 6px solid var(--yellow); border-radius: 30px;
            padding: 15px 40px; margin-bottom: 20px; text-align: center;
            box-shadow: 0 8px 0 var(--yellow); min-width: 180px;
        }
        #target-kana { font-size: 4.5rem; font-weight: bold; margin: 5px 0; }

        /* å¡ç‰‡/æ–¹å¡Šç¶²æ ¼ (ä¸é‡ç–Š) */
        .item-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 15px; width: 100%;
        }

        .game-item {
            background: white; border-radius: 20px; border: 3px solid var(--blue);
            padding: 25px 10px; text-align: center; font-size: 2.2rem;
            font-weight: bold; box-shadow: 0 5px 0 var(--blue);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .game-item:active { transform: translateY(4px); box-shadow: 0 1px 0 var(--blue); }
        .game-item.study { border-color: var(--yellow); box-shadow: 0 5px 0 var(--yellow); }
        .game-item .roma-hint { display: block; font-size: 0.8rem; color: #bbb; margin-top: 5px; }

        .version-tag { position: fixed; bottom: 8px; right: 12px; font-size: 11px; opacity: 0.5; }
    </style>
</head>
<body>

    <div class="nav-header">
        <a href="https://liliancir0125.github.io/Rumi_Study_Hall/" class="btn-home">ğŸ  å›å¤§å»³</a>
        <div style="font-weight: bold;">å¾—åˆ†: <span id="score" style="color:#ff8fa3">0</span></div>
    </div>

    <div class="control-panel">
        <div class="mode-selector">
            <button class="mode-btn active" id="btn-study" onclick="setMode('study')">ğŸ“– èªå­—ç·´ç¿’</button>
            <button class="mode-btn" id="btn-quiz" onclick="setMode('quiz')">ğŸ® æŒ‘æˆ°é–‹å§‹</button>
        </div>
        <div class="row-selector" id="row-btns"></div>
    </div>

    <div id="main-stage"></div>

    <div class="version-tag">Ver. 3.4.0</div>

    <script>
        const kanaData = {
            'ã‚': [{k:'ã‚', r:'a'},{k:'ã„', r:'i'},{k:'ã†', r:'u'},{k:'ãˆ', r:'e'},{k:'ãŠ', r:'o'}],
            'ã‹': [{k:'ã‹', r:'ka'},{k:'ã', r:'ki'},{k:'ã', r:'ku'},{k:'ã‘', r:'ke'},{k:'ã“', r:'ko'}],
            'ã•': [{k:'ã•', r:'sa'},{k:'ã—', r:'shi'},{k:'ã™', r:'su'},{k:'ã›', r:'se'},{k:'ã', r:'so'}],
            'ãŸ': [{k:'ãŸ', r:'ta'},{k:'ã¡', r:'chi'},{k:'ã¤', r:'tsu'},{k:'ã¦', r:'te'},{k:'ã¨', r:'to'}],
            'ãª': [{k:'ãª', r:'na'},{k:'ã«', r:'ni'},{k:'ã¬', r:'nu'},{k:'ã­', r:'ne'},{k:'ã®', r:'no'}]
        };
        
        let currentMode = 'study', activeRows = ['ã‚'], score = 0, target = {};

        function speak(t) {
            const ut = new SpeechSynthesisUtterance(t);
            ut.lang = 'ja-JP'; ut.rate = 0.9;
            window.speechSynthesis.speak(ut);
        }

        function setMode(m) {
            currentMode = m;
            document.getElementById('btn-study').classList.toggle('active', m==='study');
            document.getElementById('btn-quiz').classList.toggle('active', m==='quiz');
            render();
        }

        function toggleRow(row) {
            if (activeRows.includes(row)) {
                if (activeRows.length > 1) activeRows = activeRows.filter(r => r !== row);
            } else {
                activeRows.push(row);
            }
            updateRowBtns();
            render();
        }

        function updateRowBtns() {
            const container = document.getElementById('row-btns');
            container.innerHTML = '';
            Object.keys(kanaData).forEach(row => {
                const btn = document.createElement('button');
                btn.className = 'row-btn' + (activeRows.includes(row) ? ' active' : '');
                btn.innerText = row + ' è¡Œ';
                btn.onclick = () => toggleRow(row);
                container.appendChild(btn);
            });
        }

        function render() {
            const stage = document.getElementById('main-stage');
            stage.innerHTML = '';
            let currentList = [];
            activeRows.forEach(row => currentList = currentList.concat(kanaData[row]));

            if (currentMode === 'study') {
                const grid = document.createElement('div');
                grid.className = 'item-grid';
                currentList.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'game-item study';
                    card.innerHTML = `${item.k}<span class="roma-hint">${item.r}</span>`;
                    card.onclick = () => speak(item.k);
                    grid.appendChild(card);
                });
                stage.appendChild(grid);
            } else {
                // æ¸¬é©—æ¨¡å¼
                const quizCard = document.createElement('div');
                quizCard.className = 'quiz-card';
                quizCard.innerHTML = `<div style="font-size:0.9rem;opacity:0.6">é€™å€‹æ€éº¼è®€ï¼Ÿ</div><div id="target-kana">?</div>`;
                stage.appendChild(quizCard);
                
                const grid = document.createElement('div');
                grid.className = 'item-grid';
                // æ¸¬é©—æ™‚éš¨æ©Ÿæ‰“äº‚é¸é …
                const shuffled = [...currentList].sort(() => Math.random() - 0.5);
                shuffled.forEach(item => {
                    const btn = document.createElement('div');
                    btn.className = 'game-item';
                    btn.innerText = item.r;
                    btn.onclick = () => checkAnswer(item.r);
                    grid.appendChild(btn);
                });
                stage.appendChild(grid);
                newQuestion(currentList);
            }
        }

        function newQuestion(list) {
            target = list[Math.floor(Math.random() * list.length)];
            document.getElementById('target-kana').innerText = target.k;
            speak(target.k);
        }

        function checkAnswer(roma) {
            if (roma === target.r) {
                score += 10;
                document.getElementById('score').innerText = score;
                render(); // ç­”å°ç›´æ¥åˆ·æ–°å‡ºæ–°é¡Œ
            } else {
                alert("ä¸å°å–”ï¼é€™å€‹æ˜¯ " + target.r);
            }
        }

        window.onload = () => {
            updateRowBtns();
            render();
        };
    </script>
</body>
</html>
